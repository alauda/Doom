---
weight: 40
i18n:
  title:
    en: Installing
    ru: Установка
title: Установка
sourceSHA: 11b11d0473aa7d4477feeba8aca5b7cac76ed12de9b6cb7cbe847f3b7e8ce359
---

# Установка

В этом разделе описаны конкретные шаги установки управляющего кластера. Следующие операции выполняются в порядке "Подготовка → Выполнение → Проверка", а ключевые параметры описаны в конфигурации пользовательского интерфейса.

### Шаг 1: Скачайте пакет установки

**Подготовка**

- Войдите в **Портал клиента**, чтобы получить последний пакет установки и файлы подписи.
- Если у вас еще нет учетной записи, обратитесь в техническую поддержку.

**Выполнение**

- После завершения загрузки используйте инструмент GPG для проверки целостности пакета установки.
- Установите инструмент GPG в соответствии с вашей операционной системой (смотрите команды ниже).

```bash
# Ubuntu
sudo apt-get install gnupg
# CentOS
yum install gnupg
# Mac
brew install gpg
```

**Проверка**
Следуйте шагам ниже для проверки:

#### 1.1 Скачайте и проверьте открытый ключ

```bash
curl -O https://www.alauda.cn/download/verify-key.pub
md5sum verify-key.pub
```

- Выводимое значение MD5 должно быть: `2eaddfab97d2951a8915f327acb53562`.

#### 1.2 Импортируйте открытый ключ и проверьте отпечаток

```bash
gpg --import verify-key.pub
gpg --fingerprint BB097AE6
```

- Отпечаток должен точно совпадать:
  ```
  09EE E7B9 A30C F4B3 5E31 A91B 2704 1C16 BB09 7AE6
  ```

#### 1.3 Проверьте подпись пакета установки

```bash
gpg --verify <файл подписи> <пакет установки>
```

Например:

```bash
gpg --verify cpaas-devops-2.14.0.tgz.sig cpaas-devops-2.14.0.tgz
```

- Нормальный вывод должен содержать информацию "Хорошая подпись".

---

### Шаг 2: Загрузите пакет установки на управляющий узел

**Подготовка**

- Убедитесь, что целевой управляющий узел доступен по сети и имеет достаточное хранилище (не менее 100 ГБ после распаковки).

**Выполнение**

- Загрузите пакет установки в рекомендованную директорию на управляющем узле `/root/cpaas-install`, и распакуйте его:

```shell
tar -xvf {path_to_installation_package}/{installation_package_name} -C /root/cpaas-install
cd /root/cpaas-install/installer || exit 1
```

**Проверка**

- Проверьте, что структура распакованного каталога завершена.

---

### Шаг 3: Запустите установщик

**Подготовка**

- Убедитесь, что управляющий узел доступен по сети, а ПК может получить доступ к его IP.
- Проверьте, что зависимости настроены в соответствии с требованиями.

**Выполнение**

- Запустите установщик по умолчанию (используя сетевой плагин Kube-OVN):

```bash
bash setup.sh
```

- Чтобы использовать сетевой плагин Calico, выполните:

```bash
bash setup.sh --network-mode calico
```

- Чтобы указать режим IPv6 или двойного стека, вы можете добавить параметры `--ip-family ipv6` или `--ip-family dual`.

**Проверка**

- После запуска установщика терминал командной строки выведет адрес доступа к веб-интерфейсу; подождите около 5 минут, а затем получите доступ к странице на ПК, чтобы убедиться, что она загружается корректно.

---

### Шаг 4: Установите управляющий кластер (Настройте параметры UI)

**Подготовка**
В веб-интерфейсе настройте ключевые параметры для установки управляющего кластера в соответствии с подсказками, с деталями, приведенными ниже:

- **Версия Kubernetes**

  - Все версии являются необязательными и были тщательно протестированы.
  - Рекомендуется выбрать последнюю версию для оптимальных функций и поддержки.

- **Протокол сети кластера**

  - Поддерживает IPv4 одноразовый стек, IPv6 одноразовый стек и IPv4/IPv6 двойной стек.
  - Примечание: При выборе режима двойного стека все узлы должны быть правильно настроены с IPv6-адресами; параметры сетевого протокола нельзя изменить после конфигурации.

- **Адрес кластера**

  - Введите подготовленный `глобальный VIP` для внешнего доступа к kube-apiserver.
  - Если настроен LoadBalancer, пожалуйста, укажите его VIP-адрес и отключите "Самостоятельно создаваемый VIP"; в противном случае включите "Самостоятельно создаваемый VIP" и введите необходимый VIP, установщик автоматически развернет keepalived.

- **Адрес доступа к платформе**

  - Введите подготовленный `Внешний IP` или доменное имя.
  - Доступ по HTTPS включен по умолчанию; если нужен HTTP, включите его в расширенных настройках.
  - Поддерживает несколько конфигураций адресов: вы можете ввести внутренние адреса и добавить внешние адреса в "Другие настройки > Другие адреса доступа к платформе".

- **Сертификат**

  - По умолчанию используется самоподписанный сертификат для поддержки HTTPS.
  - Чтобы настроить сертификат, пожалуйста, загрузите существующий сертификат.

- **Репозиторий образов**

  - По умолчанию используется репозиторий образов, развернутый на платформе, который включает все образы компонентов.
  - Если вам нужно использовать внешний репозиторий образов, пожалуйста, свяжитесь с технической поддержкой, чтобы получить план синхронизации образов для настройки.

- **Сетевая инфраструктура контейнера**

  - Подсеть и диапазон сервисов для управляющего кластера не должны пересекаться.
  - При использовании сетевого решения Kube-OVN Overlay убедитесь, что контейнерная сеть и сетевая сеть хоста находятся в разных подсетях, чтобы предотвратить сетевые аномалии.

- **Имя узла**

  - Если вы выбрали "Использовать имя хоста в качестве имени узла", убедитесь, что все имена узлов уникальны.

- **Глобальная блокировка узлов платформы кластера**

  - Включите это при планировании работы нагрузок на управляющем кластере.
  - После включения узлы могут быть установлены в состояние "Эксклюзивная платформа", что означает, что они будут запускать только компоненты платформы; типы DaemonSet являются исключением.

- **Добавить узел**
  - **Контрольный узел**:
    - Вы можете добавить 1 или 3 контрольных узла (3 для конфигурации высокой доступности).
    - Если "Эксклюзивная платформа" включена, отключите "Разворачиваемые приложения", и контрольные узлы будут запускать только компоненты платформы; в противном случае вы можете выбрать, включить ли "Разворачиваемые приложения".
  - **Вычислительный узел**:
    - Если "Эксклюзивная платформа" включена, отключите "Разворачиваемые приложения"; в противном случае это должно быть включено.
  - При использовании Kube-OVN вы можете указать сетевую карту узла, введя имя шлюза.
  - Если проверка доступности узла не удалась, пожалуйста, отрегулируйте, как указано на странице, и повторно добавьте.

**Выполнение**

- Заполните параметры конфигурации в соответствии с подсказками веб-интерфейса, затем начните мастера установки для установки.

**Проверка**

- После завершения установки на странице будет отображен адрес доступа к платформе и статус установки; если возникли ошибки, пожалуйста, внесите изменения, как указано.

---

### Шаг 5: Проверьте успешность установки

**Подготовка**

- Войдите в веб-интерфейс платформы и подтвердите статус управляющего кластера.

**Выполнение**

- В представлении "Управление платформой" щелкните "Управление кластером > Кластер" и найдите кластер с именем `глобальный`;
- Выберите "CLI инструменты" из выпадающего меню справа и выполните следующие команды для проверки статуса:

```shell
# Проверьте наличие неудачных Charts
kubectl get apprelease --all-namespaces
# Проверьте наличие неудачных Pods
kubectl get pod --all-namespaces | awk '{if ($4 != "Running" && $4 != "Completed")print}' | awk -F'[/ ]+' '{if ($3 != $4)print}'
```

**Проверка**

- Убедитесь, что вывод не содержит аномалий или сбоев.
- Если есть исключения, пожалуйста, обратитесь к руководству по устранению неполадок для решения проблемы.

**Уведомление о совместимости с браузерами**
Рекомендуется обращаться к платформе, используя следующие браузеры:

- **Google Chrome**: Версия 93 и выше
- **Firefox**: Версия 92 и выше
